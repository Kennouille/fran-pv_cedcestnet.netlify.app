<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques</title>
    <link rel="stylesheet" href="statistiques.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Pour PDF (optionnel) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Statistiques</h1>

        <!-- Nouvelle section pour les statistiques employés -->
        <div class="employee-stats" id="employeeStatsSection">
            <h2 id="employeeStatsTitle">Statistiques Employés</h2>
            <div class="employee-selection">
                <div class="select-group">
                    <label for="yearSelect">Année :</label>
                    <select id="yearSelect">
                        <!-- Les options seront ajoutées dynamiquement -->
                    </select>
                </div>
                <div class="select-group">
                    <label for="monthSelect">Mois :</label>
                    <select id="monthSelect">
                        <option value="1">Janvier</option>
                        <option value="2">Février</option>
                        <option value="3">Mars</option>
                        <option value="4">Avril</option>
                        <option value="5">Mai</option>
                        <option value="6">Juin</option>
                        <option value="7">Juillet</option>
                        <option value="8">Août</option>
                        <option value="9">Septembre</option>
                        <option value="10">Octobre</option>
                        <option value="11">Novembre</option>
                        <option value="12">Décembre</option>
                    </select>
                </div>
                <div class="select-group">
                    <label for="employeeSelect">Employé :</label>
                    <select id="employeeSelect">
                        <!-- Les options seront ajoutées dynamiquement -->
                    </select>
                </div>
                <button onclick="calculateEmployeeStats()">Calculer les statistiques</button>
            </div>

            <div class="employee-results">
                <h3>Résultats pour l'employé :</h3>
                <div id="employeeDailyHours"></div>
            </div>
        </div>

        <!-- Section des statistiques générales - avec ID pour pouvoir la masquer -->
        <div class="date-selection" id="generalStatsSection">
            <h2>Statistiques Générales</h2>
            <label for="startDate">Date de début :</label>
            <input type="date" id="startDate">
            <label for="endDate">Date de fin :</label>
            <input type="date" id="endDate">
            <div class="buttons">
                <button onclick="setLastWeek()">Dernière semaine</button>
                <button onclick="setLastMonth()">Mois précédent</button>
                <button onclick="setLast30Days()">30 derniers jours</button>
                <button onclick="setCurrentMonth()">Mois en cours</button>
                <button onclick="calculateGeneralManualPeriod()">Calcul manuel</button>
                <button onclick="exportDataToCsv()">Exporter CSV</button>
                <button onclick="exportToPdf()">Exporter PDF</button>
                <!-- Bouton spécifique pour employés -->
                <button onclick="exportEmployeeStatsToPdf()">PDF Employé</button>
            </div>
        </div>

        <!-- Display Statistics Results -->
        <div class="stats-results" id="generalStatsResults">
            <h2>Résultats :</h2>

            <!-- Indicateur de chargement -->
            <div id="loadingIndicator" style="display: none; padding: 10px; background: #f0f0f0; margin-bottom: 10px;"></div>

            <!-- Métriques de synthèse -->
            <div class="summary-metrics">
                <div class="metric-card">
                    <div id="totalAmount" class="metric-value">Montant total : --</div>
                    <div id="totalAmountComparison" class="metric-comparison"></div>
                </div>
                <div class="metric-card">
                    <div id="averagePricePerEvent" class="metric-value">Prix moyen par événement : --</div>
                    <div id="averagePricePerEventComparison" class="metric-comparison"></div>
                </div>
                <div class="metric-card">
                    <div id="averageEventsPerDay" class="metric-value">Moyenne événements/jour : --</div>
                    <div id="averageEventsPerDayComparison" class="metric-comparison"></div>
                </div>
            </div>

            <!-- Graphiques -->
            <div class="charts-container">
                <div class="chart-wrapper">
                    <h3>Événements par employé</h3>
                    <canvas id="eventsByPersonChart" height="300"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>Top clients</h3>
                    <canvas id="topClientsChart" height="300"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>Événements par jour de la semaine</h3>
                    <canvas id="eventsByDayOfWeekChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Section pour l'export PDF (cachée) -->
        <div id="statsReportSection" style="display: none;">
            <h1>Rapport Statistiques</h1>
            <div id="pdfContent"></div>
        </div>

    </div>

    <!-- Scripts -->
    <script type="module" src="statistiques.js"></script>
</body>
</html>